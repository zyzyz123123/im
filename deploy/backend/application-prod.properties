# IM 生产环境配置文件
# 使用方法: java -jar im.jar --spring.profiles.active=prod

spring.application.name=im

# MySQL 配置 - Docker 环境使用环境变量覆盖
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:mysql://mysql:3306/im}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:root}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:root123456}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# 数据库连接池配置
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=30000

# Redis 配置 - Docker 环境使用环境变量覆盖
# 这里设置空值，让环境变量生效
spring.redis.host=${SPRING_REDIS_HOST:redis}
spring.redis.port=${SPRING_REDIS_PORT:6379}
spring.redis.password=${SPRING_REDIS_PASSWORD:}
spring.redis.database=0
spring.redis.timeout=10000
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-wait=-1ms
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0

# Session 配置
spring.session.store-type=redis
spring.session.redis.namespace=im:session

# Elasticsearch 配置 - Docker 环境使用环境变量覆盖
spring.elasticsearch.uris=${SPRING_ELASTICSEARCH_URIS:http://elasticsearch:9200}

# MyBatis 配置
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.zyzyz.im.entity
mybatis.configuration.map-underscore-to-camel-case=true
mybatis.configuration.default-fetch-size=1000
mybatis.configuration.default-statement-timeout=300

# 服务器配置
server.port=8080

# 文件上传配置
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=50MB

# 日志配置
logging.level.root=INFO
logging.level.com.zyzyz.im=INFO
logging.file.name=/var/log/im/application.log
logging.file.max-size=10MB
logging.file.max-history=30

# AI 配置（通义千问）- 请替换为你的 API Key
ai.apiKey=sk-3412ea7c64bc4584b5cdc0c17b5aba6e
ai.apiUrl=https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
ai.fileUploadUrl=https://dashscope.aliyuncs.com/compatible-mode/v1/files
ai.model=qwen-plus
ai.visionModel=qwen-vl-max
ai.documentModel=qwen-long
ai.maxHistory=10
# AI 服务访问 MinIO 的地址（Docker 环境用容器名）
ai.minioEndpoint=${AI_MINIO_ENDPOINT:http://minio:9000}

# Spring Session Redis 专用配置（重要！解决 localhost 连接问题）
spring.session.redis.configure-action=none
spring.data.redis.host=${SPRING_REDIS_HOST:redis}
spring.data.redis.port=${SPRING_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_REDIS_PASSWORD:}

# MinIO 配置 - Docker 环境使用环境变量覆盖
minio.endpoint=${MINIO_ENDPOINT:http://minio:9000}
minio.accessKey=${MINIO_ACCESSKEY:minioadmin}
minio.secretKey=${MINIO_SECRETKEY:minioadmin}
minio.bucketName=${MINIO_BUCKETNAME:zyzyz-im}
# MinIO 公开访问地址（留空则使用相对路径，生产环境可配置为完整域名）
minio.publicUrl=${MINIO_PUBLICURL:}
